<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Shelley's Journal</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Fauna One -->
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fauna+One&display=swap">

  <style>
    :root {
      --text-size: 15px;
      --text-color: #333;
      --muted: #b7b7b7;
      --border-soft: #ececec;
    }

    * {
      box-sizing: border-box;
    }

    body {
      font-family: "Fauna One", serif;
      font-size: var(--text-size);
      margin: 0;
      padding: 0;
      background: #fff;
      color: var(--text-color);
      display: flex;
      min-height: 100vh;
    }

    .sidebar {
      width: 350px;
      max-width: 40%;
      border-right: 1px solid var(--border-soft);
      background: #fafafa;
      padding: 24px 20px;
      overflow-y: auto;
    }

    .main {
      flex: 1;
      padding: 24px 40px 40px;
      display: flex;
      flex-direction: column;
      background: #ffffff;
    }

    .entry-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .entry-list li {
      margin-bottom: 8px;
    }

    .entry-list button {
      width: 100%;
      text-align: left;
      padding: 4px 0;
      border: none;
      background: none;
      font: inherit;
      font-size: var(--text-size);
      color: var(--text-color);
      cursor: pointer;
    }

    .entry-list button:hover {
      text-decoration: underline;
    }

    /* underline current day even when not hovered */
    .entry-list button.current-day {
      text-decoration: underline;
    }

    .date-nav {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 12px;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border-soft);
    }

    .date-nav-left,
    .date-nav-right {
      min-width: 80px;
      text-align: left;
      white-space: nowrap;
    }

    .date-nav-right {
      text-align: right;
    }

    .date-display {
      font-weight: 400;
    }

    .skip-today {
      display: inline-block;
      margin-top: 4px;
      font-size: var(--text-size);
      color: #777;
      text-decoration: underline;
      cursor: pointer;
    }

    button {
      font-family: inherit;
      font-size: var(--text-size);
      cursor: pointer;
      border: none;
      background: none;
      padding: 0;
      color: var(--text-color);
    }

    button.primary,
    button.danger {
      text-decoration: underline;
    }

    label {
      display: block;
      font-size: var(--text-size);
      margin-bottom: 6px;
    }

    .form-wrapper {
      flex: 1;
      display: flex;
      justify-content: center;
    }

    .journal-inner {
      width: 100%;
      max-width: 600px;
      margin-top: 32px;
    }

    .field {
      margin: 32px 0;
      padding-bottom: 24px;
      border-bottom: 1px solid var(--border-soft);
    }

    .field:last-of-type {
      border-bottom: none;
      padding-bottom: 0;
    }

    .mood-group {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
      margin-top: 16px; /* more top padding above radios */
    }

    .mood-group label {
      display: inline-flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      font-size: 12px;
    }

    .mood-group input[type="radio"] {
        margin-bottom:10px;
      cursor: pointer;
      transform: scale(1.4);   /* bigger radios */
      accent-color: #444;      /* filled color when selected */
      
    }

    textarea {
      width: 100%;
      font-family: inherit;
      font-size: var(--text-size);
      line-height: 1.6;
      border: none;
      border-radius: 0;
      padding: 0;
      margin-top: 4px;
      min-height: 160px;
      resize: none;
      background: transparent;
      color: var(--text-color);
      outline: none;
    }

    textarea::placeholder {
      color: var(--muted);
    }

    .char-counter {
      font-size: var(--text-size);
      color: var(--muted);
      text-align: right;
      margin-top: 6px;
    }

    .form-actions {
      margin-top: 32px;
      display: flex;
      align-items: center;
      gap: 16px;
      flex-wrap: wrap;
    }

    .meta {
      font-size: var(--text-size);
      color: var(--muted);
    }

    @media (max-width: 900px) {
      body {
        flex-direction: column;
      }
      .sidebar {
        width: 100%;
        max-width: 100%;
        max-height: 180px;
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
      }
      .main {
        padding: 20px;
      }
    }
  </style>
</head>
<body>
  <aside class="sidebar">
    <ul class="entry-list" id="entry-list"></ul>
  </aside>

  <main class="main">
    <header class="date-nav">
      <div class="date-nav-left">
        <button type="button" id="prev-day">Yesterday</button>
      </div>
      <div style="text-align: center; flex: 1;">
        <div class="date-display" id="date-display"></div>
        <button type="button" class="skip-today" id="today-btn">Skip to today.</button>
      </div>
      <div class="date-nav-right">
        <button type="button" id="next-day">Tomorrow</button>
      </div>
    </header>

    <div class="form-wrapper">
      <section class="journal-inner">
        <form id="journal-form">
          <!-- Mood as 1â€“10 radio buttons -->
          <div class="field">
            <label>Today I'm feeling...</label>
            <div class="mood-group" id="mood-group">
              <label><input type="radio" name="mood" value="1">1</label>
              <label><input type="radio" name="mood" value="2">2</label>
              <label><input type="radio" name="mood" value="3">3</label>
              <label><input type="radio" name="mood" value="4">4</label>
              <label><input type="radio" name="mood" value="5">5</label>
              <label><input type="radio" name="mood" value="6">6</label>
              <label><input type="radio" name="mood" value="7">7</label>
              <label><input type="radio" name="mood" value="8">8</label>
              <label><input type="radio" name="mood" value="9">9</label>
              <label><input type="radio" name="mood" value="10">10</label>
            </div>
          </div>

          <!-- What happened with 400 char limit -->
          <div class="field">
            <label for="highlights">Some things that happened today were...</label>
            <textarea
              id="highlights"
              name="highlights"
              maxlength="400"
              placeholder="Start typing here."
            ></textarea>
            <div class="char-counter" id="highlights-counter">0 / 400</div>
          </div>

          <div class="form-actions">
            <button type="button" class="primary" id="save-btn">That's all for today.</button>
            <button type="button" class="danger" id="delete-btn">Delete today.</button>
            <span class="meta" id="save-status"></span>
          </div>
        </form>
      </section>
    </div>
  </main>

  <script>
    // --- Utilities ---
    function pad(n) {
      return n < 10 ? "0" + n : "" + n;
    }

    // Use local time instead of UTC to avoid off-by-one-day issues
    function formatDate(date) {
      return (
        date.getFullYear() + "-" + pad(date.getMonth() + 1) + "-" + pad(date.getDate())
      ); // YYYY-MM-DD
    }

    function prettyDate(iso) {
      const [year, month, day] = iso.split("-").map(Number);
      const d = new Date(year, month - 1, day);
      return d.toLocaleDateString(undefined, {
        weekday: "long",
        month: "long",
        day: "numeric",
        year: "numeric",
      });
    }

    function loadAllEntries() {
      try {
        return JSON.parse(localStorage.getItem("journalEntries")) || {};
      } catch (e) {
        return {};
      }
    }

    function saveAllEntries(entries) {
      localStorage.setItem("journalEntries", JSON.stringify(entries));
    }

    // --- State ---
    let currentDate = new Date();

    const dateDisplay = document.getElementById("date-display");
    const entryListEl = document.getElementById("entry-list");
    const saveStatus = document.getElementById("save-status");
    const highlightsInput = document.getElementById("highlights");
    const highlightsCounter = document.getElementById("highlights-counter");
    const moodRadios = Array.from(document.querySelectorAll('input[name="mood"]'));

    function getSelectedMood() {
      const checked = moodRadios.find((r) => r.checked);
      return checked ? checked.value : "";
    }

    function setSelectedMood(value) {
      moodRadios.forEach((r) => {
        r.checked = r.value === String(value);
      });
    }

    function setCurrentDate(date) {
      currentDate = date;
      const iso = formatDate(currentDate);
      dateDisplay.textContent = prettyDate(iso);
      loadEntryForCurrentDate();
    }

    function loadEntryForCurrentDate() {
      const iso = formatDate(currentDate);
      const entries = loadAllEntries();
      const entry = entries[iso] || {
        mood: "",
        highlights: ""
      };

      setSelectedMood(entry.mood || "");
      highlightsInput.value = entry.highlights || "";
      updateHighlightsCounter();
      saveStatus.textContent = "";
    }

    function saveCurrentEntry() {
      const iso = formatDate(currentDate);
      const entries = loadAllEntries();

      entries[iso] = {
        mood: getSelectedMood(),
        highlights: highlightsInput.value.trim(),
        updatedAt: new Date().toISOString(),
      };

      saveAllEntries(entries);
      renderEntryList();
      saveStatus.textContent = "Saved.";
      setTimeout(() => {
        if (saveStatus.textContent === "Saved.") saveStatus.textContent = "";
      }, 2000);
    }

    function deleteCurrentEntry() {
      const iso = formatDate(currentDate);
      const entries = loadAllEntries();

      if (!entries[iso]) {
        saveStatus.textContent = "No entry to delete for this date.";
        setTimeout(() => {
          if (saveStatus.textContent === "No entry to delete for this date.") {
            saveStatus.textContent = "";
          }
        }, 2000);
        return;
      }

      const confirmed = window.confirm(
        "Delete this entry for " + prettyDate(iso) + "?"
      );
      if (!confirmed) return;

      delete entries[iso];
      saveAllEntries(entries);

      setSelectedMood("");
      highlightsInput.value = "";
      updateHighlightsCounter();
      renderEntryList();

      saveStatus.textContent = "Entry deleted.";
      setTimeout(() => {
        if (saveStatus.textContent === "Entry deleted.") saveStatus.textContent = "";
      }, 2000);
    }

    function renderEntryList() {
      const entries = loadAllEntries();
      const dates = Object.keys(entries).sort().reverse(); // newest first
      const todayIso = formatDate(new Date());

      entryListEl.innerHTML = "";
      if (dates.length === 0) {
        entryListEl.innerHTML =
          '<li><span class="meta">No entries yet.</span></li>';
        return;
      }

      dates.forEach((iso) => {
        const li = document.createElement("li");
        const btn = document.createElement("button");

        // Sidebar: date only
        btn.textContent = prettyDate(iso);

        // underline current day
        if (iso === todayIso) {
          btn.classList.add("current-day");
        }

        btn.addEventListener("click", () => {
          const [y, m, d] = iso.split("-").map(Number);
          setCurrentDate(new Date(y, m - 1, d));
        });

        li.appendChild(btn);
        entryListEl.appendChild(li);
      });
    }

    function updateHighlightsCounter() {
      const len = highlightsInput.value.length;
      highlightsCounter.textContent = `${len} / 400`;
    }

    // --- Event listeners ---
    document.getElementById("prev-day").addEventListener("click", () => {
      const d = new Date(currentDate);
      d.setDate(d.getDate() - 1);
      setCurrentDate(d);
    });

    document.getElementById("next-day").addEventListener("click", () => {
      const d = new Date(currentDate);
      d.setDate(d.getDate() + 1);
      setCurrentDate(d);
    });

    document.getElementById("today-btn").addEventListener("click", () => {
      setCurrentDate(new Date());
    });

    document.getElementById("save-btn").addEventListener("click", saveCurrentEntry);
    document.getElementById("delete-btn").addEventListener("click", deleteCurrentEntry);

    moodRadios.forEach((r) => {
      r.addEventListener("change", saveCurrentEntry);
    });

    highlightsInput.addEventListener("input", () => {
      updateHighlightsCounter();
      saveCurrentEntry();
    });

    // --- Init ---
    setCurrentDate(new Date());
    renderEntryList();
  </script>
</body>
</html>
